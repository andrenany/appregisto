<ion-header>
  <ion-toolbar class="header-toolbar">
    <ion-title class="header-title"></ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismissModal()">Cerrar</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding background-image" [ngStyle]="{'background-image': 'url(assets/imgs/imagenmn.jpg)', 'background-size': 'cover', 'background-position': 'center'}">
  <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="form-container">
    <div class="form-title">Restablecer Contraseña</div>

    <ion-item *ngIf="!showPasswordFields" class="input-item">
      <ion-label position="floating">Usuario</ion-label>
      <ion-input
        type="text"
        formControlName="username"
        placeholder="Usuario"
        required
        autocomplete="username">
      </ion-input>
    </ion-item>
    <ion-text color="danger" *ngIf="resetForm.get('username')?.invalid && resetForm.get('username')?.touched">
      <p class="error-text">El nombre de usuario es requerido.</p>
    </ion-text>

    <ion-button
      *ngIf="!showPasswordFields"
      expand="full"
      size="large"
      shape="round"
      color="primary"
      (click)="verificarUsuario()"
      [disabled]="resetForm.get('username')?.invalid"
      class="action-button">
      Verificar Usuario
    </ion-button>

    <div *ngIf="showPasswordFields" class="password-fields">
      <ion-item class="input-item">
        <ion-label position="floating"></ion-label>
        <ion-input
          type="password"
          formControlName="new_password"
          placeholder="Nueva Contraseña"
          required
          minlength="8"
          autocomplete="new-password">
        </ion-input>
      </ion-item>
      <ion-text color="danger" *ngIf="resetForm.get('new_password')?.invalid && resetForm.get('new_password')?.touched">
        <p class="error-text">La contraseña debe tener al menos 8 caracteres.</p>
      </ion-text>

      <ion-item class="input-item">
        <ion-label position="floating"></ion-label>
        <ion-input
          type="password"
          formControlName="confirm_password"
          placeholder="Confirmar Contraseña"
          required
          minlength="8"
          autocomplete="new-password">
        </ion-input>
      </ion-item>
      <ion-text color="danger" *ngIf="resetForm.get('confirm_password')?.invalid && resetForm.get('confirm_password')?.touched">
        <p class="error-text">La confirmación de contraseña es requerida.</p>
      </ion-text>
      <ion-text color="danger" *ngIf="resetForm.hasError('passwordMismatch') && resetForm.get('confirm_password')?.touched">
        <p class="error-text">Las contraseñas no coinciden.</p>
      </ion-text>
      <ion-button
        expand="full"
        size="large"
        shape="round"
        color="primary"
        (click)="onSubmit()"
        [disabled]="resetForm.invalid || resetForm.hasError('passwordMismatch')"
        class="action-button">
        Confirmar Nueva Contraseña
      </ion-button>
    </div>
  </form>
</ion-content>
